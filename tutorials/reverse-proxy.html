<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx Reverse Proxy with Cloudflare SSL | Gunshell Documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/gunshell.png">
    <meta name="description" content="This is the documentation for Gunshell.">
    
    <link rel="preload" href="/assets/css/0.styles.5cc65ce2.css" as="style"><link rel="preload" href="/assets/js/app.fab4fe65.js" as="script"><link rel="preload" href="/assets/js/2.57151568.js" as="script"><link rel="preload" href="/assets/js/1.cc04b476.js" as="script"><link rel="preload" href="/assets/js/34.df8807b9.js" as="script"><link rel="prefetch" href="/assets/js/10.1f6eb508.js"><link rel="prefetch" href="/assets/js/11.4db4a15d.js"><link rel="prefetch" href="/assets/js/12.a5738fc7.js"><link rel="prefetch" href="/assets/js/13.d691808f.js"><link rel="prefetch" href="/assets/js/14.32d8bed6.js"><link rel="prefetch" href="/assets/js/15.5d41547e.js"><link rel="prefetch" href="/assets/js/16.76eabcce.js"><link rel="prefetch" href="/assets/js/17.6a4e1cc7.js"><link rel="prefetch" href="/assets/js/18.d5bc4610.js"><link rel="prefetch" href="/assets/js/19.d9508249.js"><link rel="prefetch" href="/assets/js/20.2de8d9cd.js"><link rel="prefetch" href="/assets/js/21.5feef7ba.js"><link rel="prefetch" href="/assets/js/22.ecc49432.js"><link rel="prefetch" href="/assets/js/23.2b2a8dca.js"><link rel="prefetch" href="/assets/js/24.716f607d.js"><link rel="prefetch" href="/assets/js/25.a003e739.js"><link rel="prefetch" href="/assets/js/26.6fd67d9c.js"><link rel="prefetch" href="/assets/js/27.08b7014e.js"><link rel="prefetch" href="/assets/js/28.939f9403.js"><link rel="prefetch" href="/assets/js/29.13d4b93f.js"><link rel="prefetch" href="/assets/js/3.c9601958.js"><link rel="prefetch" href="/assets/js/30.8e6619e6.js"><link rel="prefetch" href="/assets/js/31.0fcb9cb5.js"><link rel="prefetch" href="/assets/js/32.ac8c7dc4.js"><link rel="prefetch" href="/assets/js/33.7ec9f433.js"><link rel="prefetch" href="/assets/js/4.8ee5f759.js"><link rel="prefetch" href="/assets/js/5.9017f6f4.js"><link rel="prefetch" href="/assets/js/6.39b7409b.js"><link rel="prefetch" href="/assets/js/7.5cf997c4.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.33b2b47d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5cc65ce2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/gunshell.png" alt="Gunshell Documentation" class="logo"> <span class="site-name can-hide">Gunshell Documentation</span></a> <div class="links"><!----> <div class="user-settings"><a href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"></path></svg></a> <div class="user-settings-menu" style="display:none;"><div class="theme-options"><!----> <ul class="color-theme-options"><li><a href="#" class="default-theme"></a></li> <li><a href="#" class="blue-theme"></a></li><li><a href="#" class="red-theme"></a></li><li><a href="#" class="purple-theme"></a></li></ul> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox"></div> <div class="ignore-themes-options toggle-option"><label for="ignore-themes-toggle">Ignore Other Themes?</label> <input id="ignore-themes-toggle" type="checkbox"></div> <!----></div></div></div> <!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://discord.gg/AvRpCUZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://discord.gg/AvRpCUZ" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Gunshell Documentation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">Gunshell Documentation</a></li><li><a href="/commands/commands.html" class="sidebar-link">Commands</a></li><li><a href="/api.html" class="sidebar-link">Developer API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Configuration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/config/config.html" class="sidebar-link">Config</a></li><li><a href="/config/weapons.html" class="sidebar-link">Weapons Config</a></li><li><a href="/config/ammunition.html" class="sidebar-link">Ammunation Config</a></li><li><a href="/config/throwables.html" class="sidebar-link">Throwables Config</a></li><li><a href="/config/melee.html" class="sidebar-link">Melee Config</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tutorials</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorials/reverse-proxy.html" aria-current="page" class="active sidebar-link">Nginx Reverse Proxy with Cloudflare SSL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tutorials/reverse-proxy.html#before-we-start" class="sidebar-link">Before we start</a></li><li class="sidebar-sub-header"><a href="/tutorials/reverse-proxy.html#get-ssl-certificate" class="sidebar-link">Get SSL Certificate</a></li><li class="sidebar-sub-header"><a href="/tutorials/reverse-proxy.html#nginx-configuration" class="sidebar-link">Nginx Configuration</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="reverse-proxy"><a href="#reverse-proxy" class="header-anchor">#</a> Reverse Proxy</h1> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>This tutorial was written and tested for Ubuntu 18.04 and above. Other operating systems may work if you use the correct package manager. This has not been tested by me.</p></div> <h2 id="before-we-start"><a href="#before-we-start" class="header-anchor">#</a> Before we start</h2> <p>Make sure your system is up to date to avoid problems! You can update your package manager (APT) with <code>apt-get update</code> and update your packages with <code>apt update</code>.</p> <p>If you are not a root user, please type <code>sudo</code> before every command.</p> <h2 id="get-ssl-certificate"><a href="#get-ssl-certificate" class="header-anchor">#</a> Get SSL Certificate</h2> <h3 id="installing-packages"><a href="#installing-packages" class="header-anchor">#</a> Installing packages</h3> <p>To request the SSL certificate from CloudFlare, we utilize the acme.sh script, which is installed through the GitHub repository using the cURL package.</p> <p>With the following command, you'll install the cURL package, fetch the acme.sh script from GitHub, and install the script on your server. Afterward, you'll update bash to ensure the script functions correctly.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> <span class="token assign-left variable">email</span><span class="token operator">=</span><span class="token operator">&lt;</span>EMAIL<span class="token operator">&gt;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">source</span> ~/.bashrc
</code></pre></div><p>Replace <code>&lt;EMAIL&gt;</code> with the email address you used to create your Cloudflare account.</p> <h3 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h3> <p>Before requesting our SSL certificate from Cloudflare, we need to authenticate with Cloudflare. To do this, we must set our CloudFlare email and API Key as server environment variables so that the acme.sh script can access and use them.</p> <p>To simplify this process, you can obtain the Cloudflare Global API Key on the following <a href="https://dash.cloudflare.com/profile/api-tokens" target="_blank" rel="noopener noreferrer">page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Then, you can use the following commands to set your Cloudflare Email and API Key in the environment variables:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">CF_Key</span><span class="token operator">=</span><span class="token string">&quot;&lt;API_KEY&gt;&quot;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CF_Email</span><span class="token operator">=</span><span class="token string">&quot;&lt;EMAIL&gt;&quot;</span>
</code></pre></div><p>Replace <code>&lt;API_KEY&gt;</code> with the API Key you generated in the previous step and <code>&lt;EMAIL&gt;</code> with the email address you used to create your Cloudflare account.</p> <h3 id="request-ssl"><a href="#request-ssl" class="header-anchor">#</a> Request SSL</h3> <p>Before requesting the SSL certificate from Cloudflare, we need to create a directory where we will store the SSL certificate files. In this tutorial, we will use <code>/etc/ssl/example.com</code> as the directory.</p> <p>Create a directory with the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /etc/ssl/<span class="token operator">&lt;</span>DOMAIN<span class="token operator">&gt;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Make sure to replace <code>&lt;DOMAIN&gt;</code> with your domain in the above and all following commands.</p></div> <p>Now we can request the SSL Certificate from Cloudflare using the acme.sh script.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>acme.sh <span class="token parameter variable">--issue</span> <span class="token parameter variable">--dns</span> dns_cf <span class="token parameter variable">-d</span> <span class="token string">&quot;&lt;DOMAIN&gt;&quot;</span> <span class="token punctuation">\</span>
--key-file /etc/ssl/<span class="token operator">&lt;</span>DOMAIN<span class="token operator">&gt;</span>/privkey.pem <span class="token punctuation">\</span>
--fullchain-file /etc/ssl/<span class="token operator">&lt;</span>DOMAIN<span class="token operator">&gt;</span>/fullchain.pem
</code></pre></div><h2 id="nginx-configuration"><a href="#nginx-configuration" class="header-anchor">#</a> Nginx Configuration</h2> <p>Now comes the somewhat simpler part of the tutorial.</p> <p>We are going to create the Nginx configuration for the reverse proxy. First, we need to create an Nginx configuration file in the <code>sites-available</code> folder and create a symbolic link to it in the <code>sites-enabled</code> folder. You can create a symlink with the next command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/nginx/sites-available/reverse.conf /etc/nginx/sites-enabled/reverse.conf
</code></pre></div><p>We assume your nginx configuration file is called <code>reverse.conf</code>.</p> <p>To force the SSL certificate, we create an automatic HTTPS forwarder. You can easily achieve this by adding the following code to your Nginx configuration:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> &lt;DOMAIN&gt;</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next, we set up a server listener on port 443 (HTTPS port) and redirect it with the SSL certificate to our application using the following code:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> &lt;DOMAIN&gt;</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/&lt;DOMAIN&gt;/fullchain.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/&lt;DOMAIN&gt;/privkey.pem</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://&lt;IP&gt;:&lt;PORT&gt;/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When you combine all of this, your Nginx configuration will look like this:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> &lt;DOMAIN&gt;</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> &lt;DOMAIN&gt;</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/&lt;DOMAIN&gt;/fullchain.pem</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/&lt;DOMAIN&gt;/privkey.pem</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://&lt;IP&gt;:&lt;PORT&gt;/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Remember to replace <code>&lt;DOMAIN&gt;</code>, <code>&lt;IP&gt;</code>, and <code>&lt;PORT&gt;</code> with your actual domain, IP address, and port of your application.</p> <p>And now, your Reverse Proxy is set up! To start using it, you can restart or reload Nginx with the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> nginx restart
</code></pre></div><p>Your Nginx Reverse Proxy should work now!</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/config/melee.html" class="prev">
        Melee Config
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fab4fe65.js" defer></script><script src="/assets/js/2.57151568.js" defer></script><script src="/assets/js/1.cc04b476.js" defer></script><script src="/assets/js/34.df8807b9.js" defer></script>
  </body>
</html>
